{% extends 'base.html' %}

{% block title %}{{ game.title }} — {{ game.base_game or 'Decompiled Port' }} for {{ (game.consoles or [game.console]) | join(', ') }} | ROMHACKS.NET{% endblock %}
{% block og_type %}article{% endblock %}
{% block meta_image %}{{ game.image_url }}{% endblock %}
{% block meta_description %}{{ (game.title ~ ' decompiled port of ' ~ (game.base_game or 'the original') ~ ' with downloads for ' ~ ((game.consoles or [game.console]) | join(', ')) ~ '. ' ~ (game.description or 'Includes install steps, patch links, and notes from the team.')) | truncate(155, True, '…') }}{% endblock %}
{% block meta_keywords %}{{ game.title }}, {{ game.base_game }}, {{ (game.consoles or [game.console]) | join(', ') }}, decompiled port, download, how to install{% endblock %}

{% block json_ld %}
<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "VideoGame",
    "name": {{ (game.title or '') | tojson }},
    "description": {{ (game.description or '') | tojson }},
    "url": {{ url_for('port_page', port_id=game.id, _external=True) | tojson }},
    "image": {{ (game.image_url or '') | tojson }},
    "creator": {
        "@type": "Person",
        "name": {{ (game.author or 'ROMHACKS.NET Team') | tojson }}
    },
    "datePublished": {{ (game.release_date or '') | tojson }},
    "softwareVersion": {{ (game.version or '') | tojson }},
    "applicationPlatform": {{ ((game.consoles or [game.console]) | join('/')) | tojson }},
    "isBasedOn": {{ (game.base_game or '') | tojson }},
    "offers": {
        "@type": "Offer",
        "url": {{ (game.download_link or url_for('port_page', port_id=game.id, _external=True)) | tojson }},
        "availability": "https://schema.org/InStock",
        "price": "0",
        "priceCurrency": "USD"
    }
}
</script>
{% endblock %}

{% block content %}
<div class="flex flex-col gap-6 max-w-6xl mx-auto">
    <div class="relative min-h-[280px] md:h-[380px] rounded-2xl overflow-hidden border border-gray-700/50 shadow-2xl bg-gradient-to-br from-gray-800 to-gray-900">
        <img src="{{ game.image_url }}" loading="lazy" decoding="async" class="w-full h-full object-contain object-center opacity-40" alt="{{ game.title }} - {{ game.console }} Port Cover Art">
        <div class="absolute inset-0 bg-gradient-to-t from-[#050507] to-transparent"></div>
        <div class="absolute bottom-0 left-0 right-0 p-4 md:p-8">
            <div class="flex items-end justify-between">
                <div>
                    <div class="flex flex-wrap items-center gap-1.5 md:gap-4 mb-3 md:mb-4">
                        {% for c in (game.consoles or [game.console]) %}
                        <span class="{{ styles.get(c, styles.get('default', 'bg-gray-800 text-gray-300 border-gray-600')) }} text-[10px] font-bold px-3 py-1 rounded border uppercase bg-opacity-80">{{ c }}</span>
                        {% endfor %}
                        <span class="text-xs font-mono text-gray-400 border border-gray-700 px-2 py-1 bg-black/50">Released: {{ game.release_date[:4] if game.release_date else '' }}</span>
                    </div>
                    <h1 class="text-3xl md:text-5xl font-bold text-white pixel-font mb-6">{{ game.title }}</h1>
                    <div class="flex flex-col sm:flex-row items-start sm:items-center gap-3">
                        <div class="border-l-2 border-blue-400 pl-3">
                            <div class="text-xs text-gray-400 uppercase font-bold tracking-wider">By {{ game.author }}</div>
                        </div>
                        <div class="border-l-2 border-blue-400 pl-3">
                            <div class="text-xs text-gray-400 uppercase font-bold tracking-wider">Latest Version</div>
                            <div class="text-lg text-white font-mono font-semibold">{{ game.version }}</div>
                        </div>
                    </div>
                </div>
                {% if social_links %}
                <div class="flex flex-col gap-2">
                    {% for link in social_links %}
                    <a href="{{ link.url }}" target="_blank" rel="noopener noreferrer" class="inline-flex items-center justify-center w-12 h-12 rounded-lg bg-gray-800/50 border border-gray-700/50 hover:border-blue-400/50 hover:bg-gray-800 transition-all group" title="{{ link.type|replace('_', ' ')|title }}">
                        {% if link.type == 'twitter' %}
                        <svg class="w-5 h-5 text-gray-400 group-hover:text-blue-400 transition-colors" fill="currentColor" viewBox="0 0 24 24"><path d="M23 3a10.9 10.9 0 01-3.14 1.53 4.48 4.48 0 00-7.86 3v1A10.66 10.66 0 013 4s-4 9 5 13a11.64 11.64 0 01-7 2s9 5 20 5a9.5 9.5 0 00-9-5.5c4.75 2.25 7-7 7-7a4.5 4.5 0 01-4.5-4.5"/></svg>
                        {% elif link.type == 'discord' %}
                        <svg class="w-5 h-5 text-gray-400 group-hover:text-blue-400 transition-colors" fill="currentColor" viewBox="0 0 24 24"><path d="M20.317 4.369a19.791 19.791 0 00-4.885-1.515.074.074 0 00-.079.037c-.211.375-.445.864-.607 1.25a18.27 18.27 0 00-5.487 0c-.162-.386-.395-.875-.607-1.25a.077.077 0 00-.079-.037A19.736 19.736 0 003.677 4.37a.07.07 0 00-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 00.031.057 19.9 19.9 0 005.993 3.03.08.08 0 00.087-.027c.461-.63.873-1.295 1.226-1.994a.076.076 0 00-.042-.106 13.107 13.107 0 01-1.872-.892.077.077 0 00-.008-.128 10.72 10.72 0 00.372-.294.075.075 0 00.076-.01c3.928 1.793 8.18 1.793 12.062 0a.075.075 0 00.076.009c.12.098.246.198.373.294a.077.077 0 00-.006.127 12.299 12.299 0 01-1.873.892.076.076 0 00-.041.107c.36.699.772 1.365 1.225 1.994a.08.08 0 00.087.028 19.86 19.86 0 006.002-3.03.077.077 0 00.032-.056c.5-4.506.8-8.987.111-13.374a.07.07 0 00-.031-.027zM8.02 15.33c-1.183 0-2.157-.965-2.157-2.156 0-1.193.964-2.157 2.157-2.157 1.193 0 2.156.964 2.156 2.157 0 1.19-.963 2.156-2.156 2.156zm7.975 0c-1.183 0-2.157-.965-2.157-2.156 0-1.193.964-2.157 2.157-2.157 1.193 0 2.157.964 2.157 2.157 0 1.19-.964 2.156-2.157 2.156z"/></svg>
                        {% elif link.type == 'github' %}
                        <svg class="w-5 h-5 text-gray-400 group-hover:text-blue-400 transition-colors" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v 3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
                        {% elif link.type == 'website' %}
                        <span class="material-symbols-outlined text-lg text-gray-400 group-hover:text-blue-400 transition-colors">language</span>
                        {% else %}
                        <span class="material-symbols-outlined text-lg text-gray-400 group-hover:text-blue-400 transition-colors">language</span>
                        {% endif %}
                    </a>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Screenshots and Info Section -->
    {% if game.screenshots %}
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 no-crt-filter">
        <!-- Screenshots on Left -->
        <div class="lg:col-span-2 space-y-4">
            <h3 class="text-xl font-bold text-white pixel-font flex items-center gap-2">
                <span class="material-symbols-outlined text-blue-500">photo_library</span> Screenshots
            </h3>
            <!-- Main Screenshot Display -->
            <div class="relative rounded-xl overflow-hidden border border-gray-800 bg-black/20 shadow-lg aspect-video group cursor-pointer" onclick="openScreenshotModal(currentScreenshotIndex)">
                <img id="main-screenshot" src="{{ game.screenshots[0] }}" loading="lazy" decoding="async" class="w-full h-full object-contain" alt="{{ game.title }} Screenshot">
                
                <!-- Navigation Arrows Overlay -->
                {% if game.screenshots|length > 1 %}
                <button onclick="selectScreenshot(currentScreenshotIndex - 1); event.stopPropagation();" class="absolute left-4 top-1/2 -translate-y-1/2 text-white/50 hover:text-white transition-all opacity-0 group-hover:opacity-100 p-2" id="prev-arrow">
                    <span class="material-symbols-outlined text-4xl">chevron_left</span>
                </button>
                <button onclick="selectScreenshot(currentScreenshotIndex + 1); event.stopPropagation();" class="absolute right-4 top-1/2 -translate-y-1/2 text-white/50 hover:text-white transition-all opacity-0 group-hover:opacity-100 p-2" id="next-arrow">
                    <span class="material-symbols-outlined text-4xl">chevron_right</span>
                </button>
                {% endif %}
                <div class="absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-all flex items-center justify-center opacity-0 group-hover:opacity-100">
                    <span class="material-symbols-outlined text-white text-5xl">zoom_in</span>
                </div>
            </div>
            
            <!-- Thumbnail Navigation -->
            {% if game.screenshots|length > 1 %}
            <div class="flex justify-center">
                <div class="overflow-hidden">
                    <div id="thumbnail-container" class="flex gap-2 transition-transform duration-300">
                        {% for shot in game.screenshots %}
                        <button 
                            class="flex-shrink-0 w-20 h-20 rounded border-2 transition-all cursor-pointer hover:border-blue-400 {% if loop.first %}border-blue-400{% else %}border-gray-700/50{% endif %} overflow-hidden"
                            onclick="selectScreenshot({{ loop.index0 }})"
                            title="Screenshot {{ loop.index }}">
                            <img src="{{ shot }}" class="w-full h-full object-cover" alt="Screenshot {{ loop.index }}">
                        </button>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Info Sidebar on Right -->
        <div class="lg:col-span-1 space-y-6">
            <div class="bg-gray-900/50 border border-gray-800 p-6 rounded-lg sticky top-24">
                <div class="mb-4">
                    <div class="text-xs text-gray-500 uppercase font-bold mb-1">Base Game</div>
                    <div class="text-sm text-gray-300">{{ game.base_game }}</div>
                </div>

                {% if game.original_platform %}
                <div class="mb-6">
                    <div class="text-xs text-gray-500 uppercase font-bold mb-1">Original Platform</div>
                    <div class="text-sm text-gray-300">
                        {% if game.original_platform|lower == 'nintendo 64' %}
                            N64
                        {% elif game.original_platform|lower == 'game boy' %}
                            GB
                        {% elif game.original_platform|lower == 'game boy color' %}
                            GBC
                        {% elif game.original_platform|lower == 'game boy advance' %}
                            GBA
                        {% elif game.original_platform|lower == 'super nintendo' %}
                            SNES
                        {% elif game.original_platform|lower == 'nintendo ds' %}
                            NDS
                        {% else %}
                            {{ game.original_platform }}
                        {% endif %}
                    </div>
                </div>
                {% endif %}

                <a href="{{ game.download_link }}" target="_blank" onclick="trackDownload('{{ game.id }}')" class="btn-retro w-full justify-center text-center py-4 mb-4">
                    Download Port
                </a>

                <div class="flex items-center justify-between px-2 py-2 mb-4">
                    <span class="inline-flex items-center gap-2 text-[12px] font-mono text-gray-300">
                        <span class="material-symbols-outlined text-[14px] text-blue-400">download</span>
                        <span id="download-count">{{ download_count | default(0) | download_count_label }}</span> downloads
                    </span>
                </div>

                <div class="border-t border-gray-800 pt-4 mt-4">
                    <p class="text-[10px] text-gray-500 mb-2">Have the file?</p>
                    <a href="/patcher" class="block text-center text-blue-400 text-xs hover:text-white border border-blue-500/30 hover:border-blue-500 py-2 transition-all">
                        Go to Web Patcher
                    </a>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Content Below -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="md:col-span-2 space-y-8">
            <section>
                <h3 class="text-xl font-bold text-white mb-4 border-b border-gray-800 pb-2">Features</h3>
                <ul class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                    {% if game.online_play %}
                    <li class="flex items-center gap-3 bg-green-900/30 p-3 rounded-lg border border-green-600/50">
                        <span class="material-symbols-outlined text-green-400 text-sm">lan</span> 
                        <span class="text-sm text-green-300">Online Play</span>
                    </li>
                    {% endif %}
                </ul>
            </section>

           {% if instructions %}
            <section>
                <h3 class="text-xl font-bold text-white mb-4 border-b border-gray-800 pb-2">Platform Instructions</h3>
                <div class="space-y-3">
                    {% set platforms = game.consoles or [game.console] %}
                    {% for platform in platforms %}
                    {% set platform_lower = platform|lower|replace(' ', '_')|replace('-', '_') %}
                    {% set platform_upper = platform|upper|replace(' ', '_')|replace('-', '_') %}
                    {% set platform_instructions = instructions.get(platform_lower, '') or instructions.get(platform_upper, '') %}
                    {% if platform_instructions %}
                    <div class="border border-gray-700/50 rounded-lg overflow-hidden">
                        <button 
                            class="w-full px-6 py-4 bg-gray-900/50 hover:bg-gray-800/50 transition-all flex items-center justify-between group"
                            onclick="toggleInstructions('{{ platform|replace(' ', '_') }}')">
                            <div class="flex items-center gap-3">
                                <span class="material-symbols-outlined text-blue-400">info</span>
                                <span class="font-bold text-white">{{ platform }}</span>
                            </div>
                            <span class="material-symbols-outlined text-gray-400 group-hover:text-white transition-all transform text-lg font-bold" id="icon-{{ platform|replace(' ', '_') }}">expand_more</span>
                        </button>
                        <div 
                            id="content-{{ platform|replace(' ', '_') }}"
                            class="instructions-content hidden max-h-0 overflow-hidden transition-all duration-300"
                            data-instructions="{{ platform_instructions|escape }}">
                            <div class="px-6 py-4 bg-[#151518] border-t border-gray-700/50">
                                <p class="text-xs text-gray-400 leading-relaxed whitespace-pre-line">{{ platform_instructions|replace('\\n', '\n') }}</p>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    {% endfor %}
                </div>
            </section>
            {% endif %}

            <!-- Modding Instructions Section -->
            {% set has_mods = false %}
            {% for feature in key_features %}
                {% if feature.title and feature.title|lower == 'mods' %}
                    {% set has_mods = true %}
                {% endif %}
            {% endfor %}
            {% if has_mods and (game.mod_links or game.mod_instructions) %}
            <section>
                <h3 class="text-xl font-bold text-white mb-4 border-b border-gray-800 pb-2 flex items-center gap-2">
                    <span class="material-symbols-outlined text-purple-400">build</span>
                    Modding Instructions
                </h3>
                <div class="border border-purple-700/50 rounded-lg overflow-hidden bg-gray-900/30">
                    <!-- Mod Links -->
                    {% if game.mod_links %}
                    <div class="px-6 py-4 border-b border-purple-700/30">
                        <h4 class="text-sm font-bold text-purple-300 mb-3 flex items-center gap-2">
                            <span class="material-symbols-outlined text-sm">link</span>
                            Mod Resources
                        </h4>
                        <div class="flex flex-wrap gap-3">
                            {% set mod_links_parsed = game.mod_links %}
                            {% if mod_links_parsed is string %}
                                {% set mod_links_parsed = mod_links_parsed | tojson | safe %}
                            {% endif %}
                            {% for link in mod_links_parsed if mod_links_parsed is iterable and mod_links_parsed is not string %}
                            <a href="{{ link.url }}" target="_blank" rel="noopener noreferrer" 
                               class="inline-flex items-center gap-2 px-4 py-2 bg-purple-900/50 hover:bg-purple-800/50 border border-purple-600/50 rounded-lg text-purple-200 text-sm font-medium transition-all hover:border-purple-400/50">
                                <span class="material-symbols-outlined text-sm">open_in_new</span>
                                {{ link.name }}
                            </a>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                    
                    <!-- Mod Instructions -->
                    {% if game.mod_instructions %}
                    <div class="px-6 py-4">
                        <h4 class="text-sm font-bold text-purple-300 mb-3 flex items-center gap-2">
                            <span class="material-symbols-outlined text-sm">menu_book</span>
                            How to Install Mods
                        </h4>
                        <div class="text-xs text-gray-400 leading-relaxed whitespace-pre-line bg-[#151518] p-4 rounded-lg border border-gray-700/50">{{ game.mod_instructions|replace('\\n', '\n') }}</div>
                    </div>
                    {% endif %}
                </div>
            </section>
            {% endif %}
        </div>

        <div class="md:col-span-1">
        </div>
    </div>

    <div class="flex justify-center mt-8 mb-4">
        <a href="{{ url_for('contact') }}" class="inline-flex items-center gap-2 text-gray-500 hover:text-blue-400 text-sm transition-all">
            <span class="material-symbols-outlined text-base">report</span>
            Incorrect info?
        </a>
    </div>

</div>

<!-- Screenshot Modal Lightbox -->
<div id="screenshot-modal" class="fixed inset-0 bg-black/90 hidden z-50 flex items-center justify-center p-4" onclick="closeScreenshotModal(event)">
    <button onclick="closeScreenshotModal()" class="absolute top-4 right-4 text-white/70 hover:text-white transition-all">
        <span class="material-symbols-outlined text-4xl">close</span>
    </button>
    
    <div class="relative w-full h-full flex items-center justify-center" onclick="event.stopPropagation()">
        <img id="modal-screenshot" src="" loading="lazy" decoding="async" class="max-w-full max-h-full object-contain" alt="Enlarged screenshot">
        
        <!-- Modal Navigation -->
        <button onclick="modalPrevScreenshot()" class="absolute left-4 top-1/2 -translate-y-1/2 text-white/50 hover:text-white transition-all p-3" id="modal-prev-arrow">
            <span class="material-symbols-outlined text-5xl">chevron_left</span>
        </button>
        <button onclick="modalNextScreenshot()" class="absolute right-4 top-1/2 -translate-y-1/2 text-white/50 hover:text-white transition-all p-3" id="modal-next-arrow">
            <span class="material-symbols-outlined text-5xl">chevron_right</span>
        </button>
        
        <!-- Screenshot Counter -->
        <div class="absolute bottom-4 left-1/2 -translate-x-1/2 bg-black/50 px-4 py-2 rounded-lg text-white/70 text-sm font-mono">
            <span id="modal-counter">1</span> / <span id="modal-total">1</span>
        </div>
    </div>
</div>

<!-- Screenshot Navigation Scripts -->
<script>
const allScreenshots = [
    {% for shot in game.screenshots %}'{{ shot }}'{{ "," if not loop.last }}{% endfor %}
];

let currentScreenshotIndex = 0;
const thumbnailWidth = 88; // width (80px) + gap (8px)

function selectScreenshot(index) {
    // Clamp index to valid range
    index = Math.max(0, Math.min(index, allScreenshots.length - 1));
    currentScreenshotIndex = index;
    
    const mainImg = document.getElementById('main-screenshot');
    if (mainImg) {
        mainImg.src = allScreenshots[index];
    }
    
    // Update thumbnail borders
    document.querySelectorAll('#thumbnail-container button').forEach((btn, i) => {
        btn.classList.toggle('border-blue-400', i === index);
        btn.classList.toggle('border-gray-700/50', i !== index);
    });
    
    // Auto-scroll to show selected thumbnail
    ensureThumbbnailVisible(index);
    updateArrowState();
}

function scrollThumbnails(direction) {
    const container = document.getElementById('thumbnail-container');
    if (!container) return;
    const scrollAmount = thumbnailWidth * 3; // Scroll by 3 thumbnails
    container.scrollBy({ left: direction * scrollAmount, behavior: 'smooth' });
}

function ensureThumbbnailVisible(index) {
    const container = document.getElementById('thumbnail-container');
    if (!container) return;
    const button = container.querySelector(`button:nth-child(${index + 1})`);
    if (button) {
        button.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
    }
}

function updateArrowState() {
    const prevArrow = document.getElementById('prev-arrow');
    const nextArrow = document.getElementById('next-arrow');
    
    if (prevArrow) {
        prevArrow.style.opacity = currentScreenshotIndex === 0 ? '0' : '1';
        prevArrow.style.pointerEvents = currentScreenshotIndex === 0 ? 'none' : 'auto';
    }
    
    if (nextArrow) {
        nextArrow.style.opacity = currentScreenshotIndex >= allScreenshots.length - 1 ? '0' : '1';
        nextArrow.style.pointerEvents = currentScreenshotIndex >= allScreenshots.length - 1 ? 'none' : 'auto';
    }
}

// Keyboard navigation
document.addEventListener('keydown', (e) => {
    if (e.key === 'ArrowLeft' && currentScreenshotIndex > 0) {
        selectScreenshot(currentScreenshotIndex - 1);
    } else if (e.key === 'ArrowRight' && currentScreenshotIndex < allScreenshots.length - 1) {
        selectScreenshot(currentScreenshotIndex + 1);
    }
});

// Update arrow states on load and resize
window.addEventListener('load', updateArrowState);
window.addEventListener('resize', updateArrowState);

// Screenshot Modal Functions
function openScreenshotModal(index) {
    const modal = document.getElementById('screenshot-modal');
    const modalImg = document.getElementById('modal-screenshot');
    const counter = document.getElementById('modal-counter');
    const total = document.getElementById('modal-total');
    
    if (modal && modalImg && allScreenshots.length > 0) {
        currentScreenshotIndex = Math.max(0, Math.min(index, allScreenshots.length - 1));
        modalImg.src = allScreenshots[currentScreenshotIndex];
        counter.textContent = currentScreenshotIndex + 1;
        total.textContent = allScreenshots.length;
        modal.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
        updateModalArrowState();
    }
}

function closeScreenshotModal(event) {
    // Only close if clicking the background, not the image
    if (event && event.target.id !== 'screenshot-modal') return;
    
    const modal = document.getElementById('screenshot-modal');
    if (modal) {
        modal.classList.add('hidden');
        document.body.style.overflow = '';
    }
}

function modalNextScreenshot() {
    if (currentScreenshotIndex < allScreenshots.length - 1) {
        currentScreenshotIndex++;
        updateModalImage();
    }
}

function modalPrevScreenshot() {
    if (currentScreenshotIndex > 0) {
        currentScreenshotIndex--;
        updateModalImage();
    }
}

function updateModalImage() {
    const modalImg = document.getElementById('modal-screenshot');
    const counter = document.getElementById('modal-counter');
    
    if (modalImg && allScreenshots.length > 0) {
        modalImg.src = allScreenshots[currentScreenshotIndex];
        counter.textContent = currentScreenshotIndex + 1;
        updateModalArrowState();
    }
}

function updateModalArrowState() {
    const prevArrow = document.getElementById('modal-prev-arrow');
    const nextArrow = document.getElementById('modal-next-arrow');
    
    if (prevArrow) {
        prevArrow.style.opacity = currentScreenshotIndex === 0 ? '0.2' : '1';
        prevArrow.style.pointerEvents = currentScreenshotIndex === 0 ? 'none' : 'auto';
    }
    
    if (nextArrow) {
        nextArrow.style.opacity = currentScreenshotIndex >= allScreenshots.length - 1 ? '0.2' : '1';
        nextArrow.style.pointerEvents = currentScreenshotIndex >= allScreenshots.length - 1 ? 'none' : 'auto';
    }
}

// Modal keyboard shortcuts
document.addEventListener('keydown', (e) => {
    const modal = document.getElementById('screenshot-modal');
    if (modal && !modal.classList.contains('hidden')) {
        if (e.key === 'ArrowLeft') {
            modalPrevScreenshot();
        } else if (e.key === 'ArrowRight') {
            modalNextScreenshot();
        } else if (e.key === 'Escape') {
            closeScreenshotModal();
        }
    }
});

// Instructions Accordion
function toggleInstructions(platform) {
    const content = document.getElementById(`content-${platform}`);
    const icon = document.getElementById(`icon-${platform}`);
    
    if (!content) return;
    
    const isHidden = content.classList.contains('hidden');
    
    // Close all other instructions
    document.querySelectorAll('.instructions-content').forEach(el => {
        if (el.id !== `content-${platform}`) {
            el.classList.add('hidden');
            el.style.maxHeight = '0';
        }
    });
    
    // Update all icons
    document.querySelectorAll('[id^="icon-"]').forEach(el => {
        if (el.id !== `icon-${platform}`) {
            el.textContent = 'expand_more';
        }
    });
    
    // Toggle current
    if (isHidden) {
        content.classList.remove('hidden');
        setTimeout(() => {
            content.style.maxHeight = content.scrollHeight + 'px';
        }, 10);
        icon.textContent = 'expand_less';
    } else {
        content.style.maxHeight = '0';
        setTimeout(() => {
            content.classList.add('hidden');
        }, 300);
        icon.textContent = 'expand_more';
    }
}
</script>
{% endblock %}