<!DOCTYPE html>
<html lang="en">
<head>
    <script data-goatcounter="https://natto.goatcounter.com/count"
        async src="https://gc.zgo.at/count.js"></script>
    <noscript>
        <img src="https://natto.goatcounter.com/count?p=/noscript" alt="">
    </noscript>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <link rel="icon" type="image/svg+xml" href="/logo/favicon.svg">
    <link rel="icon" type="image/png" href="/logo/favicon.png">
    <title>{% block title %}{{ site_name or 'romhacks_' }}{% endblock %}</title>

    {# ---- SEO defaults (override per-template with blocks) ---- #}
    {#
      NOTE: These blocks exist so child templates can override SEO values,
      but we do NOT want their raw contents emitted into <head> as text nodes.
    #}
    {% if false %}
        {% block meta_description %}{% endblock %}
        {% block meta_image %}{% endblock %}
        {% block meta_keywords %}{% endblock %}
        {% block og_type %}website{% endblock %}
    {% endif %}

    {% set _canonical = canonical_url or request.base_url %}
    {% set _meta_description = (self.meta_description() | striptags | trim) %}
    {% if not _meta_description %}
        {% set _meta_description = site_description or 'Discover ROM hacks and decompiled ports. Download patch files and use the web patcher locally in your browser.' %}
    {% endif %}
    {% set _meta_title = (self.title() | striptags | trim) %}
    {% set _meta_image = (self.meta_image() | striptags | trim) %}
    {% if not _meta_image %}
        {% set _meta_image = (site_image_url or '') %}
    {% endif %}
    {% set _meta_keywords = (self.meta_keywords() | striptags | trim) %}
    {% set _og_type = (self.og_type() | striptags | trim) %}

    <meta name="description" content="{{ _meta_description }}">
    {% if _meta_keywords %}
    <meta name="keywords" content="{{ _meta_keywords }}">
    {% endif %}
    <link rel="canonical" href="{{ _canonical }}">
    <meta name="robots" content="index,follow">
        <meta name="theme-color" content="#050507">

        {# Prevent white flash before CSS loads #}
        <style>
            html { background: #050507; }
        </style>

    {# Open Graph #}
    <meta property="og:site_name" content="{{ site_name or 'romhacks_' }}">
    <meta property="og:title" content="{{ _meta_title }}">
    <meta property="og:description" content="{{ _meta_description }}">
    <meta property="og:type" content="{{ _og_type }}">
    <meta property="og:url" content="{{ _canonical }}">
    {% if _meta_image %}
    <meta property="og:image" content="{{ _meta_image }}">
    {% endif %}
    <meta property="og:locale" content="en_US">

    {# Twitter #}
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{ _meta_title }}">
    <meta name="twitter:description" content="{{ _meta_description }}">
    {% if _meta_image %}
    <meta name="twitter:image" content="{{ _meta_image }}">
    {% endif %}

    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

    <script src="{{ url_for('static', filename='js/lzma.js') }}"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,1,0" rel="stylesheet">
    
    <link rel="preload" href="{{ url_for('static', filename='fonts/PressStart2P-Regular.ttf') }}" as="font" type="font/ttf" crossorigin>

        {# Default JSON-LD; override/extend per page with json_ld block #}
        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@graph": [
                {
                    "@type": "WebSite",
                    "name": {{ (site_name or 'romhacks_') | tojson }},
                    "url": {{ (site_url or request.url_root.rstrip('/')) | tojson }}
                },
                {
                    "@type": "WebPage",
                    "name": {{ _meta_title | tojson }},
                    "url": {{ _canonical | tojson }},
                    "description": {{ _meta_description | tojson }}
                }
            ]
        }
        </script>
        {% block json_ld %}{% endblock %}
</head>
<body class="min-h-screen flex flex-col relative overflow-x-hidden selection:bg-blue-500 selection:text-white">
    
    <div class="scanline"></div>

    <header class="bg-[#0a0a0f]/80 backdrop-blur-xl border-b border-white/5 sticky top-0 z-30">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center gap-8 md:gap-12">
                <div class="flex items-center gap-2">
                    <a href="/" class="logo" title="ROMHACKS.NET">
                        <span class="logo-rom">rom</span><span class="logo-hacks">hacks</span><span class="logo-underscore">_</span>
                    </a>
                    <span class="dev-badge">ALPHA</span>
                </div>
                
                <nav class="hidden md:flex gap-1 items-center">
                    <a class="px-4 py-2 rounded-lg text-sm font-medium transition-all
                              {% if request.path == '/' %} bg-white/10 text-white {% else %} text-gray-400 hover:text-white hover:bg-white/5 {% endif %}" 
                       href="/">
                        Home
                    </a>
                    <a class="px-4 py-2 rounded-lg text-sm font-medium transition-all
                              {% if request.path == '/romhacks' %} bg-white/10 text-white {% else %} text-gray-400 hover:text-white hover:bg-white/5 {% endif %}" 
                       href="/romhacks">
                        Romhacks
                    </a>
                    <a class="px-4 py-2 rounded-lg text-sm font-medium transition-all
                              {% if request.path == '/ports' %} bg-white/10 text-white {% else %} text-gray-400 hover:text-white hover:bg-white/5 {% endif %}" 
                       href="/ports">
                        Ports
                    </a>
                    <a class="px-4 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-1.5
                              {% if request.path == '/patcher' %} bg-white/10 text-white {% else %} text-gray-400 hover:text-white hover:bg-white/5 {% endif %}" 
                       href="/patcher">
                        <span class="material-symbols-outlined text-[16px]">build</span>
                        Patcher
                    </a>
                </nav>
            </div>
            
            <div class="flex items-center gap-3">
                <a href="https://ko-fi.com/romhacksnet" target="_blank" class="hidden sm:flex items-center gap-1.5 px-3 py-2 rounded-lg text-sm font-medium text-amber-400 hover:bg-amber-500/10 transition-all">
                    <span class="material-symbols-outlined text-[16px]">favorite</span>
                    Donate
                </a>
                
                <a href="{{ url_for('submit') }}" class="bg-blue-600 hover:bg-blue-500 text-white font-medium py-2 px-4 rounded-lg text-sm flex items-center gap-2 transition-all">
                    <span class="material-symbols-outlined text-[16px] hidden sm:inline">add</span>
                    <span class="sm:hidden">Submit</span>
                    <span class="hidden sm:inline">Submit Game</span>
                </a>
                
                <!-- Mobile Menu Button -->
                <button id="mobile-menu-btn" class="md:hidden flex items-center justify-center w-10 h-10 rounded-lg text-gray-400 hover:text-white hover:bg-white/10 transition-all" aria-label="Open menu">
                    <span class="material-symbols-outlined text-2xl" id="menu-icon">menu</span>
                </button>
            </div>
        </div>
        
        <!-- Mobile Navigation Menu -->
        <div id="mobile-menu" class="hidden md:hidden bg-[#0a0a0f]/95 backdrop-blur-xl border-t border-white/5">
            <nav class="container mx-auto px-4 py-4 flex flex-col gap-2">
                <a class="px-4 py-3 rounded-lg text-base font-medium transition-all flex items-center gap-3
                          {% if request.path == '/' %} bg-white/10 text-white {% else %} text-gray-400 hover:text-white hover:bg-white/5 {% endif %}" 
                   href="/">
                    <span class="material-symbols-outlined text-[20px]">home</span>
                    Home
                </a>
                <a class="px-4 py-3 rounded-lg text-base font-medium transition-all flex items-center gap-3
                          {% if request.path == '/romhacks' %} bg-white/10 text-white {% else %} text-gray-400 hover:text-white hover:bg-white/5 {% endif %}" 
                   href="/romhacks">
                    <span class="material-symbols-outlined text-[20px]">sports_esports</span>
                    Romhacks
                </a>
                <a class="px-4 py-3 rounded-lg text-base font-medium transition-all flex items-center gap-3
                          {% if request.path == '/ports' %} bg-white/10 text-white {% else %} text-gray-400 hover:text-white hover:bg-white/5 {% endif %}" 
                   href="/ports">
                    <span class="material-symbols-outlined text-[20px]">cloud_download</span>
                    Ports
                </a>
                <a class="px-4 py-3 rounded-lg text-base font-medium transition-all flex items-center gap-3
                          {% if request.path == '/patcher' %} bg-white/10 text-white {% else %} text-gray-400 hover:text-white hover:bg-white/5 {% endif %}" 
                   href="/patcher">
                    <span class="material-symbols-outlined text-[20px]">build</span>
                    Patcher
                </a>
                <div class="border-t border-white/10 my-2"></div>
                <a href="https://ko-fi.com/romhacksnet" target="_blank" class="px-4 py-3 rounded-lg text-base font-medium text-amber-400 hover:bg-amber-500/10 transition-all flex items-center gap-3">
                    <span class="material-symbols-outlined text-[20px]">favorite</span>
                    Donate
                </a>
            </nav>
        </div>
    </header>

    <main class="container mx-auto px-4 py-12 flex-grow">
        {% block content %}{% endblock %}
    </main>

<footer class="bg-[#0f0f12] border-t border-gray-800 py-10 md:py-16 mt-auto">
        <div class="container mx-auto px-4">
            {# Footer Navigation #}
            <div class="grid grid-cols-2 md:grid-cols-4 gap-6 md:gap-8 mb-8 md:mb-12">
                <div>
                    <h4 class="text-white font-bold text-sm uppercase tracking-wider mb-3 md:mb-4"><span class="text-[#e5f0ff]">rom</span><span class="text-[#9bb6ff]">hacks</span><span class="text-[#4d7cff]">_</span></h4>
                    <ul class="space-y-2">
                        <li><a href="/" class="text-gray-400 text-xs hover:text-blue-400 transition">Home</a></li>
                        <li><a href="/romhacks" class="text-gray-400 text-xs hover:text-blue-400 transition">ROM Hacks</a></li>
                        <li><a href="/ports" class="text-gray-400 text-xs hover:text-blue-400 transition">Decompiled Ports</a></li>
                        <li><a href="/patcher" class="text-gray-400 text-xs hover:text-blue-400 transition">Web Patcher</a></li>
                    </ul>
                </div>
                
                <div>
                    <h4 class="text-white font-bold text-sm uppercase tracking-wider mb-3 md:mb-4">Community</h4>
                    <ul class="space-y-2">
                        <li><a href="{{ url_for('submit') }}" class="text-gray-400 text-xs hover:text-blue-400 transition">Submit Game</a></li>
                        <li><a href="{{ url_for('contact') }}" class="text-gray-400 text-xs hover:text-blue-400 transition">Contact & Feedback</a></li>
                        <li><a href="https://ko-fi.com/romhacksnet" target="_blank" class="text-gray-400 text-xs hover:text-amber-400 transition">Support Us</a></li>
                    </ul>
                </div>
                
                <div>
                    <h4 class="text-white font-bold text-sm uppercase tracking-wider mb-3 md:mb-4">Legal</h4>
                    <ul class="space-y-2">
                        <li><a href="{{ url_for('contact') }}" class="text-gray-400 text-xs hover:text-blue-400 transition">Report Issues</a></li>
                        <li><a href="{{ url_for('privacy_policy') }}" class="text-gray-400 text-xs hover:text-blue-400 transition">Privacy Policy</a></li>
                        <li><a href="{{ url_for('disclaimer') }}" class="text-gray-400 text-xs hover:text-blue-400 transition">Disclaimer</a></li>
                    </ul>
                </div>
                
                <div class="col-span-2 md:col-span-1">
                    <h4 class="text-white font-bold text-sm uppercase tracking-wider mb-3 md:mb-4">Contact</h4>
                    <p class="text-gray-400 text-xs mb-3 leading-relaxed">Have questions or feedback? Reach out to us directly.</p>
                    <a href="mailto:support@romhacks.net" class="inline-flex items-center gap-1 text-blue-400 hover:text-blue-300 transition text-xs">
                        <span class="material-symbols-outlined text-xs">mail</span>
                        support@romhacks.net
                    </a>
                </div>
            </div>

            {# Footer Bottom #}
            <div class="pt-8 text-center border-t border-gray-800">
                <p class="text-[11px] text-gray-500 mb-3">© 2026 <span class="text-[#e5f0ff] font-semibold">rom</span><span class="text-[#9bb6ff]">hacks</span><span class="text-[#4d7cff]">_</span> All rights reserved.</p>
                <p class="text-[10px] text-gray-600 mb-4">Made with <span class="text-red-500">♥</span> by Natto. This is a fan project not affiliated with Nintendo or any game publisher.</p>
                <div class="flex justify-center gap-4 text-[10px] text-gray-600 flex-wrap">
                    <a href="mailto:support@romhacks.net" class="hover:text-gray-400 transition">Contact</a>
                    <span class="text-gray-700">•</span>
                    <a href="{{ url_for('contact') }}" class="hover:text-gray-400 transition">Report Issues</a>
                    <span class="text-gray-700">•</span>
                    <a href="{{ url_for('submit') }}" class="hover:text-gray-400 transition">Submit Game</a>
                </div>
                <p class="text-[9px] text-gray-700 mt-4">All trademarks, logos, and copyrighted material belong to their respective owners.</p>
            </div>
        </div>
    </footer>

    <script>
    function trackDownload(gameId) {
        console.log('trackDownload called with:', gameId);
        fetch(`/api/track-download/${gameId}`, {
            method: 'POST'
        })
        .then(response => {
            console.log('Response received:', response.status);
            return response.json();
        })
        .then(data => {
            console.log('Data received:', data);
            // Update the counter on the page with the new count from the server
            const countElement = document.getElementById('download-count');
            console.log('Count element found:', countElement);
            if (countElement && data.new_count !== undefined) {
                countElement.textContent = data.new_count;
                console.log('Counter updated to:', data.new_count);
            }
        })
        .catch(error => console.error('Error tracking download:', error));
    }
    </script>

    <script src="{{ url_for('static', filename='js/rom-cache.js') }}"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    
    <!-- Mobile Menu Toggle -->
    <script>
    (function() {
        const menuBtn = document.getElementById('mobile-menu-btn');
        const mobileMenu = document.getElementById('mobile-menu');
        const menuIcon = document.getElementById('menu-icon');
        
        if (menuBtn && mobileMenu && menuIcon) {
            menuBtn.addEventListener('click', function() {
                const isOpen = !mobileMenu.classList.contains('hidden');
                if (isOpen) {
                    mobileMenu.classList.add('hidden');
                    menuIcon.textContent = 'menu';
                    menuBtn.setAttribute('aria-label', 'Open menu');
                } else {
                    mobileMenu.classList.remove('hidden');
                    menuIcon.textContent = 'close';
                    menuBtn.setAttribute('aria-label', 'Close menu');
                }
            });
        }
    })();
    </script>
</body>
</html>