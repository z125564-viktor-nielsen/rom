<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>{% block title %}{{ site_name or 'Romhacks.NET' }}{% endblock %}</title>

    {# ---- SEO defaults (override per-template with blocks) ---- #}
    {#
      NOTE: These blocks exist so child templates can override SEO values,
      but we do NOT want their raw contents emitted into <head> as text nodes.
    #}
    {% if false %}
        {% block meta_description %}{% endblock %}
        {% block meta_image %}{% endblock %}
        {% block meta_keywords %}{% endblock %}
        {% block og_type %}website{% endblock %}
    {% endif %}

    {% set _canonical = canonical_url or request.base_url %}
    {% set _meta_description = (self.meta_description() | striptags | trim) %}
    {% if not _meta_description %}
        {% set _meta_description = site_description or 'Discover ROM hacks and decompiled ports. Download patch files and use the web patcher locally in your browser.' %}
    {% endif %}
    {% set _meta_title = (self.title() | striptags | trim) %}
    {% set _meta_image = (self.meta_image() | striptags | trim) %}
    {% if not _meta_image %}
        {% set _meta_image = (site_image_url or '') %}
    {% endif %}
    {% set _meta_keywords = (self.meta_keywords() | striptags | trim) %}
    {% set _og_type = (self.og_type() | striptags | trim) %}

    <meta name="description" content="{{ _meta_description }}">
    {% if _meta_keywords %}
    <meta name="keywords" content="{{ _meta_keywords }}">
    {% endif %}
    <link rel="canonical" href="{{ _canonical }}">
    <meta name="robots" content="index,follow">
        <meta name="theme-color" content="#050507">

        {# Prevent white flash before CSS loads #}
        <style>
            html { background: #050507; }
        </style>

    {# Open Graph #}
    <meta property="og:site_name" content="{{ site_name or 'Romhacks.NET' }}">
    <meta property="og:title" content="{{ _meta_title }}">
    <meta property="og:description" content="{{ _meta_description }}">
    <meta property="og:type" content="{{ _og_type }}">
    <meta property="og:url" content="{{ _canonical }}">
    {% if _meta_image %}
    <meta property="og:image" content="{{ _meta_image }}">
    {% endif %}
    <meta property="og:locale" content="en_US">

    {# Twitter #}
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{ _meta_title }}">
    <meta name="twitter:description" content="{{ _meta_description }}">
    {% if _meta_image %}
    <meta name="twitter:image" content="{{ _meta_image }}">
    {% endif %}

    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="icon" type="image/png" href="{{ url_for('logo_file', filename='favico.png') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

    <script src="{{ url_for('static', filename='js/lzma.js') }}"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,1,0" rel="stylesheet">
    
    <link rel="preload" href="{{ url_for('static', filename='fonts/PressStart2P-Regular.ttf') }}" as="font" type="font/ttf" crossorigin>

        {# Default JSON-LD; override/extend per page with json_ld block #}
        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@graph": [
                {
                    "@type": "WebSite",
                    "name": {{ (site_name or 'Romhacks.NET') | tojson }},
                    "url": {{ (site_url or request.url_root.rstrip('/')) | tojson }}
                },
                {
                    "@type": "WebPage",
                    "name": {{ _meta_title | tojson }},
                    "url": {{ _canonical | tojson }},
                    "description": {{ _meta_description | tojson }}
                }
            ]
        }
        </script>
        {% block json_ld %}{% endblock %}
</head>
<body class="min-h-screen flex flex-col relative overflow-x-hidden selection:bg-blue-500 selection:text-white">
    
    <div class="scanline"></div>

    <header class="bg-[#1a1a20] border-b border-gray-800 sticky top-0 z-30 shadow-lg shadow-black/50">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center gap-6">
                <div class="flex items-center gap-3 group cursor-pointer" onclick="window.location.href='/'">
                    <a href="/" class="text-xl md:text-2xl font-bold pixel-font text-blue-400 tracking-tighter uppercase group-hover:text-blue-300 transition-colors shake-logo" style="text-decoration:none">Romhacks.NET</a>
                </div>
                
                <nav class="hidden md:flex gap-6 items-center">
                    <a class="uppercase text-sm font-bold transition-colors flex items-center gap-1 
                              {% if request.path == '/' %} text-blue-400 {% else %} text-gray-400 hover:text-blue-400 {% endif %}" 
                       href="/">
                        Home
                    </a>
                    <a class="uppercase text-sm font-bold transition-colors flex items-center gap-1 
                              {% if request.path == '/romhacks' %} text-blue-400 {% else %} text-gray-400 hover:text-blue-400 {% endif %}" 
                       href="/romhacks">
                        Romhacks
                    </a>
                    <a class="uppercase text-sm font-bold transition-colors flex items-center gap-1 
                              {% if request.path == '/ports' %} text-blue-400 {% else %} text-gray-400 hover:text-blue-400 {% endif %}" 
                       href="/ports">
                        Decomp Ports
                    </a>
                    <a class="uppercase text-sm font-bold transition-colors flex items-center gap-1 
                              {% if request.path == '/patcher' %} text-blue-400 {% else %} text-gray-400 hover:text-blue-400 {% endif %}" 
                       href="/patcher">
                        <span class="material-symbols-outlined text-sm">build</span> Web Patcher
                    </a>
                </nav>
            </div>
            
            <div class="flex items-center gap-6">
                <button onclick="document.getElementById('request-modal').classList.remove('hidden')" class="bg-gray-800 hover:bg-gray-700 text-blue-400 border border-blue-500/50 px-3 py-1 rounded text-xs uppercase tracking-wider flex items-center gap-2 transition-all">
                    <span class="material-symbols-outlined text-sm">add_circle</span>
                    <span class="hidden sm:inline">Request Hack</span>
                    <span class="inline sm:hidden">Request</span>
                </button>

                <a href="https://ko-fi.com/romhacksnet" target="_blank" class="bg-gradient-to-r from-yellow-600 to-amber-600 hover:from-yellow-500 hover:to-amber-500 text-white border border-yellow-400/50 px-3 py-1 rounded text-xs uppercase tracking-wider flex items-center gap-2 transition-all shadow-md">
                    <span class="material-symbols-outlined text-sm">favorite</span>
                    <span class="hidden sm:inline">Donate</span>
                </a>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-12 flex-grow">
        {% block content %}{% endblock %}
    </main>

    <footer class="bg-[#151518] border-t border-gray-800 py-12 mt-auto">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                <div class="bg-gradient-to-br from-blue-900/20 to-gray-900/50 border border-blue-500/30 p-6 rounded-lg backdrop-blur-sm">
                    <div class="flex items-center gap-2 mb-3">
                        <span class="material-symbols-outlined text-blue-400 text-lg">info</span>
                        <h3 class="text-sm font-bold text-blue-400 uppercase tracking-wider">Legal Notice</h3>
                    </div>
                    <p class="text-xs text-gray-400 leading-relaxed">
                        This site hosts educational information about ROM hacks and decompiled game projects only. We do not provide or distribute copyrighted ROMs.
Users must legally own any original games referenced. Piracy and copyright infringement are not supported or endorsed.
                    </p>
                </div>

                <div class="bg-gradient-to-br from-gray-900/50 to-blue-900/20 border border-gray-700/50 p-6 rounded-lg backdrop-blur-sm">
                    <div class="flex items-center gap-2 mb-3">
                        <span class="material-symbols-outlined text-gray-400 text-lg">gavel</span>
                        <h3 class="text-sm font-bold text-gray-300 uppercase tracking-wider">Disclaimer</h3>
                    </div>
                    <p class="text-xs text-gray-400 leading-relaxed">
                        By using this website, you agree to use all content responsibly and in compliance with applicable laws. We are not responsible for misuse of tools or materials. Always respect intellectual property and original creators.
                    </p>
                </div>
            </div>

            <div class="border-t border-gray-800 pt-6 text-center">
                <p class="text-[10px] text-gray-700">© 2026 Romhacks.NET All rights reserved. Made by Natto</p>
                <p class="text-[9px] text-gray-800 mt-2">This is a fan community project. All trademarks and copyrights belong to their respective owners.</p>
            </div>
        </div>
    </footer>

    <div class="fixed inset-0 bg-black/90 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm" id="request-modal">
        <div class="bg-[#1a1a20] w-full max-w-lg border border-blue-500/30 shadow-2xl relative flex flex-col p-8">
            <h2 class="text-2xl font-bold text-white mb-6 pixel-font text-blue-400">Request Hack</h2>
            <div class="space-y-4 mb-6">
                <div>
                    <label class="block text-xs text-gray-500 uppercase mb-1">Hack Title</label>
                    <input type="text" id="request-title" class="input-dark" placeholder="e.g., Pokemon Fire Red Enhanced">
                </div>
                <div>
                    <label class="block text-xs text-gray-500 uppercase mb-1">Base Game</label>
                    <input type="text" id="request-base-game" class="input-dark" placeholder="e.g., Pokemon Fire Red">
                </div>
                <div>
                    <label class="block text-xs text-gray-500 uppercase mb-1">Link to Patch (Optional)</label>
                    <input type="url" id="request-patch-link" class="input-dark" placeholder="https://...">
                </div>
                <div>
                    <label class="block text-xs text-gray-500 uppercase mb-1">Release Date (Optional)</label>
                    <input type="date" id="request-release-date" class="input-dark">
                </div>
                <div>
                    <label class="block text-xs text-gray-500 uppercase mb-1">Console</label>
                    <select id="request-console" class="input-dark">
                        <option value="">-- Select Console --</option>
                        <option value="gb">Game Boy</option>
                        <option value="gbc">Game Boy Color</option>
                        <option value="gba">Game Boy Advance</option>
                        <option value="snes">Super Nintendo</option>
                        <option value="n64">Nintendo 64</option>
                        <option value="nds">Nintendo DS</option>
                        <option value="wii">Wii</option>
                    </select>
                </div>
                <div>
                    <label class="block text-xs text-gray-500 uppercase mb-1">Author (Optional)</label>
                    <input type="text" id="request-author" class="input-dark" placeholder="Creator name">
                </div>
                <div>
                    <label class="block text-xs text-gray-500 uppercase mb-1">Why This Hack?</label>
                    <textarea id="request-notes" class="input-dark resize-none" rows="3" placeholder="What makes this hack special?"></textarea>
                </div>
            </div>
            <div class="flex gap-4">
                <button onclick="submitHackRequest()" class="flex-1 btn-retro justify-center text-xs">Submit Request</button>
                <button onclick="document.getElementById('request-modal').classList.add('hidden')" class="px-4 py-2 text-gray-500 hover:text-white border border-gray-700 hover:border-white transition-all text-xs uppercase font-mono">Cancel</button>
            </div>
            <div id="request-status" class="mt-4 text-sm text-gray-400 hidden"></div>
        </div>
    </div>

    <script>
    function submitHackRequest() {
        const title = document.getElementById('request-title').value;
        const baseGame = document.getElementById('request-base-game').value;
        const patchLink = document.getElementById('request-patch-link').value;
        const releaseDate = document.getElementById('request-release-date').value;
        const console_type = document.getElementById('request-console').value;
        const author = document.getElementById('request-author').value;
        const notes = document.getElementById('request-notes').value;
        const statusDiv = document.getElementById('request-status');
        
        if (!title || !baseGame || !console_type) {
            statusDiv.textContent = '❌ Please fill in all required fields';
            statusDiv.classList.remove('hidden');
            return;
        }
        
        fetch('/api/request', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                title: title,
                base_game: baseGame,
                patch_page_url: patchLink,
                release_date: releaseDate,
                console: console_type,
                author: author,
                notes: notes
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                statusDiv.textContent = '✅ Request submitted! Thank you!';
                statusDiv.classList.remove('hidden');
                statusDiv.classList.add('text-blue-400');
                // Reset form
                document.getElementById('request-title').value = '';
                document.getElementById('request-base-game').value = '';
                document.getElementById('request-patch-link').value = '';
                document.getElementById('request-release-date').value = '';
                document.getElementById('request-console').value = '';
                document.getElementById('request-author').value = '';
                document.getElementById('request-notes').value = '';
                // Close modal after 2 seconds
                setTimeout(() => {
                    document.getElementById('request-modal').classList.add('hidden');
                    statusDiv.classList.add('hidden');
                    statusDiv.classList.remove('text-green-400');
                }, 2000);
            }
        })
        .catch(error => {
            statusDiv.textContent = '❌ Error submitting request: ' + error;
            statusDiv.classList.remove('hidden');
        });
    }

    function trackDownload(gameId) {
        fetch(`/api/track-download/${gameId}`, {
            method: 'POST'
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Optionally update the counter on the page
                const countElement = document.getElementById('download-count');
                if (countElement) {
                    let currentCount = parseInt(countElement.textContent) || 0;
                    countElement.textContent = currentCount + 1;
                }
            }
        })
        .catch(error => console.error('Error tracking download:', error));
    }
    </script>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>